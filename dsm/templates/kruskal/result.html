{% extends "base.html" %}

{% block content %}
<div class="card">
    <div class="card-header bg-primary text-white">
        <h2>Алгоритм Краскала</h2>
    </div>
    <h3>Результат - Минимальное остовное дерево</h3>
    <div class="card-body">
        <div class="row">
            <div class="col-md-8">
                <div class="graph-container">
                    <img src="data:image/png;base64,{{ graphic }}" class="img-fluid">
                </div>

                <div class="mt-4">
                    <h4>Интерактивная визуализация</h4>
                    <div id="network"></div>
                </div>
            </div>

            <div class="col-md-4">
                <h4>Рёбра дерева:</h4>
                <ul class="list-group">
                    {% for edge in mst %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ edge.source }} - {{ edge.destination }}
                        <span class="badge bg-primary rounded-pill">{{ edge.weight }}</span>
                    </li>
                    {% endfor %}
                </ul>

                <div class="mt-3">
                    <h5>Общий вес дерева:</h5>
                    <p class="fw-bold">{{ total_weight }}</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const container = document.getElementById('network');
    const nodes = new vis.DataSet([
        {% for node in nodes %}
        { id: '{{ node }}', label: '{{ node }}', color: '#2196F3' },
        {% endfor %}
    ]);

    const edges = new vis.DataSet([
        {% for edge in edges %}
        {
            from: '{{ edge.source }}',
            to: '{{ edge.destination }}',
            label: '{{ edge.weight }}',
            color: {
                color: '{% if edge in mst %}#ff5722{% else %}#cccccc{% endif %}',
                highlight: '#ff5722'
            },
            width: {% if edge in mst %}3{% else %}1{% endif %},
            dashes: {% if edge not in mst %}true{% else %}false{% endif %}
        },
        {% endfor %}
    ]);

    const data = { nodes, edges };
    const options = {
        physics: { stabilization: { enabled: true, iterations: 1000 } },
        edges: { smooth: false, font: { size: 12 } },
        nodes: { font: { size: 14, color: '#fff' } }
    };

    new vis.Network(container, data, options);
</script>
{% endblock %}
